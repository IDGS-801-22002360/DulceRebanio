{% extends "admin/index.html" %}
{% block container %}

<div class="row">
    <div class="card border-0 gb mb-3" style="height: 58px; background-color: #e1e1e1">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-success" role="alert">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>
    <!-- Listado de Insumos -->
    <div class="col-6">
        <div class="card shadow-sm rounded-3 border-0 bg-white">
            <div class="card-header text-center border-0 bg-white rounded-3">
                <b>Insumos - Materias Primas</b>
            </div>
            <div class="table-responsive">
                <table class="table table-hover table-borderless text-center" id="insumosTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Insumo</th>
                            <th>Cantidad</th>
                            <th>Unidad</th>
                            <th>Caducidad</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="productosTableBody">
                        {% for insumo in insumos %}
                        <tr data-id="{{ insumo.idMateriaPrima }}" data-materia="{{ insumo.materiaPrima }}"
                            data-unidad="{{ insumo.unidadMedida }}"
                            data-fecha="{{ insumo.fechaCaducidad.strftime('%Y-%m-%d') }}">
                            <td>{{ insumo.idMateriaPrima }}</td>
                            <td>{{ insumo.materiaPrima }}</td>
                            <td>{{ insumo.cantidadDisponible }}</td>
                            <td>{{ insumo.unidadMedida }}</td>
                            <td>{{ insumo.fechaCaducidad.strftime('%d-%m-%Y') }}</td>
                            <td class="row">
                                <!-- Botón Eliminar con SweetAlert2 (ya existente) -->
                                <a href="#" class="btn btn-danger btn-sm col-4 me-2"
                                    onclick="confirmDeletion(&quot;{{ url_for('eliminar_insumo', id=insumo.idMateriaPrima) }}&quot;, &quot;este insumo&quot;); return false;"><i
                                        class="fa fa-trash text-white"></i></a>
                                <!-- Nuevo botón Mermar -->
                                <a href="#" class="btn btn-warning btn-sm col-4"
                                    onclick="mermarInsumo('{{ insumo.idMateriaPrima }}'); return false;"><i
                                        class="fa fa-delete-left text-white"></i></a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- Formulario de creación/edición de Insumo -->
    <div class="col-6">
        <form id="formInsumos" method="POST" action="{{ url_for('insumos') }}">
            {{ form.csrf_token }}
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <!-- Campo oculto para el id del insumo -->
            <input type="hidden" id="idMateriaPrima" name="idMateriaPrima" value="">
            <div class="mb-3">
                <label for="materiaPrima" class="form-label">Materia Prima</label>
                {{ form.materiaPrima(class="form-control", id="materiaPrima", placeholder="Nombre del insumo") }}
            </div>
            <div class="mb-3">
                <label for="unidadMedida" class="form-label">Unidad de Medida</label>
                {{ form.unidadMedida(class="form-control", id="unidadMedida", placeholder="Unidad de medida") }}
            </div>
            <div class="mb-3">
                <label for="fechaCaducidad" class="form-label">Fecha de Caducidad</label>
                {{ form.fechaCaducidad(class="form-control", id="fechaCaducidad") }}
            </div>
            <div class="d-flex">
                <button type="submit" class="btn btn-warning text-white font-Spartan me-2">Guardar Insumo</button>
                <!-- Botón de editar -->
                <button type="button" class="btn btn-primary text-white font-Spartan" id="btnEditar"
                    onclick="editarInsumo()">Editar Insumo</button>
            </div>
        </form>
    </div>
</div>
</div>

<!-- Definir URL de edición en una variable JavaScript -->
<script>
    var insumosEditarUrl = "{{ url_for('editar_insumo') }}";
</script>

<!-- Cargar scripts externos -->
<script src="{{ url_for('static', filename='js/sweetalert2.all.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/insumos.js') }}"></script>
{% endblock %}