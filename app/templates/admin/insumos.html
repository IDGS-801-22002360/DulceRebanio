{% extends "admin/index.html" %}
{% block container %}
<div class="row">
    <div class="card border-0 gb mb-3" style="height: 58px; background-color: #e1e1e1">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-success" role="alert">{{ message }}</div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>
    <!-- Listado de Insumos -->
    <div class="col-7">
        <div class="last-login">
            <p class="mb-0">
                <b>Último inicio de sesión:</b> {{ ultimo_login.strftime('%Y-%m-%d %H:%M:%S') if ultimo_login else
                'Nunca' }}
            </p>
        </div>
        <div class="card shadow-sm rounded-3 border-0 bg-white">
            <div class="card-header text-center border-0 bg-white rounded-3">
                <b>Insumos - Materias Primas</b>
            </div>
            <div class="table-responsive" style="max-height: 400px;">
                <table class="table table-hover text-center table-borderless" id="insumosTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Insumo</th>
                            <th>Cantidad</th>
                            <th>Unidad</th>
                            <th>Caducidad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="productosTableBody">
                        {% for insumo in insumos %}
                        <tr data-id="{{ insumo.idMateriaPrima }}" data-materia="{{ insumo.materiaPrima }}"
                            data-unidad="{{ insumo.unidadMedida }}"
                            data-fecha="{{ insumo.fechaCaducidad.strftime('%Y-%m-%d') }}">
                            <td>{{ insumo.idMateriaPrima }}</td>
                            <td>{{ insumo.materiaPrima }}</td>
                            <td>{{ insumo.cantidadDisponible }}</td>
                            <td ">{{ insumo.unidadMedida }}</td>
                            <td>{{ insumo.fechaCaducidad.strftime('%d-%m-%Y') }}</td>
                            <td class="d-flex justify-content-center gap-2">
                                <!-- Botón Eliminar con SweetAlert2 -->
                                <a href="#" class="btn btn-danger btn-sm" onclick="confirmDeletion('{{ url_for('insumos.eliminar_insumo', id=insumo.idMateriaPrima) }}', '{{ insumo.materiaPrima }}'); return false;">
                                    <i class="fa fa-trash text-white"></i>
                                </a>
                                <!-- Botón Mermar -->
                                <a href="#" class="btn btn-warning btn-sm" onclick="mermarInsumo('{{ insumo.idMateriaPrima }}'); return false;">
                                    <i class="fa fa-minus"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="card-footer border-0 bg-white rounded-bottom-3">
            </div>
        </div>
    </div>

    <!-- Formulario -->
    <div class="col-5">
        <form id="formInsumos" method="POST" action="{{ url_for('insumos.insumos') }}">
            {{ form.csrf_token }}
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="hidden" id="idMateriaPrima" name="idMateriaPrima" value="">
    
            <div class="form-floating mb-2">
                {{ form.materiaPrima(class_="form-control", id="materiaPrima", placeholder="Nombre del insumo") }}
                <label for="materiaPrima">Materia Prima</label>
            </div>
    
            <div class="form-floating mb-2">
                <select class="form-select" id="unidadMedida" name="unidadMedida">
                    <option value="" selected disabled>Seleccione una unidad</option>
                    <option value="Kilogramos">Kilogramos</option>
                    <option value="Gramos">Gramos</option>
                    <option value="Litros">Litros</option>
                    <option value="Mililitros">Mililitros</option>
                    <option value="Piezas">Piezas</option>
                </select>
                <label for="unidadMedida">Unidad de Medida</label>
            </div>
            <div class="form-floating mb-3">
                {{ form.fechaCaducidad(class_="form-control", id="fechaCaducidad", placeholder="Fecha de Caducidad") }}
                <label for="fechaCaducidad">Fecha de Caducidad</label>
            </div>
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-warning text-white">Guardar Insumo</button>
                <button type="button" class="btn btn-primary" id="btnEditar" onclick="editarInsumo()">
                    Editar Insumo
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Definir URL de edición en una variable JavaScript -->
<script>
    var insumosEditarUrl = "{{ url_for('insumos.editar_insumo') }}";
</script>

<!-- Cargar scripts externos -->
<script src="{{ url_for('static', filename='js/sweetalert2.all.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/insumos.js') }}"></script>

{% endblock %}